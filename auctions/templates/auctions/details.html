{% extends "auctions/layout.html" %}

{% block body %}
    <!-- <h3>Auctions Details</h3> -->
    {% if auction %}
        <div class="auction-item">
            <!-- Display auction details -->
            <div class="auction-details">
                <div class="left-side">
                    <img src="{{ auction.image_url }}" width="300px" alt="Image not found">
                </div>
                <div class="right-side">
                    <h4>{{ auction.title }}</h4>
                    <div class="line"></div>
                    <p>{{ auction.description }}</p>
                    <p>Current Price: <span class="bids">${{ auction.starting_bid }}</span></p>
                    {% if highest_bid %}
                        <p>Minimum Bid: <span class="bids">${{ highest_bid }}</span></p>
                    {% else %}
                        <p>No bids yet</p>
                    {% endif %}

                    <!-- üí∞ Bid Form (active auctions only) -->
                    {% if user.is_authenticated %}
                        {% if auction.is_active %}
                        <form action="{% url 'details' auction.id %}" method="post">
                            {% csrf_token %}
                            <label for="bid">Set Your Maximum Bid:</label>
                            <input type="number" id="bid" name="bid" step="0.01" min="{{ min_bid }}" required>
                            <button type="submit">Submit Bid</button>
                        </form>
                        {% endif %}
                    {% endif %} 
                </div>
            </div>
            <div class="line"></div>
            <h4>{{ auction.title }}</h4>
            
            <p>{{ auction.description }}</p>
            <p>Starting Bid: ${{ auction.starting_bid }}</p>
            <p>Created by: {{ auction.creator.username }}</p>
            <p>Created on: {{ auction.created_at }}</p>

            <!-- Here we are showing user inputed bids We will work here later on -->
           {% if messages %}
                {% for message in messages %}
                    <p class="message {{ message.tags }}">{{ message }}</p>
                {% endfor %}
            {% endif %}
            <!-- add higher bids -->
            {% if highest_bid %}
                <p>Current highest bid: ${{ highest_bid }}</p>
            {% else %}
                <p>No bids yet</p>
            {% endif %}


            <!-- Show the winner of acution -->
             {% if not auction.is_active %}
                <p>This auction is closed.</p>
                {% if auction.winner %}
                    {% if user.is_authenticated and user == auction.winner %}
                        <p>üéâ Congratulations! You won this auction.</p>
                    {% else %}
                        <p>üèÜ Winner: {{ auction.winner.username }}</p>
                    {% endif %}
                {% else %}
                    <p>No winner ‚Äî no bids were placed.</p>
                {% endif %}
            {% endif %}

                        
            {% if user.is_authenticated %}
                <!--  Close Auction Button (only for creator) -->
                {% if user == auction.creator and auction.is_active %}
                    <form action="{% url 'close_auction' auction.id %}" method="post">
                        {% csrf_token %}
                        <!-- if close is not true then show the close button Otherwise show acative button -->
                        <button type="submit">Close Auction</button>
                    </form>
                {% endif %}

                <!-- Watchlist Toggle (only if not creator) -->
                {% if user != auction.creator %}
                    <form action="{% url 'toggle_watchlist' auction.id %}" method="post">
                        {% csrf_token %}
                        {% if in_watchlist %}
                            <button type="submit">Remove from Watchlist</button>
                        {% else %}
                            <button type="submit">Add to Watchlist</button>
                        {% endif %}
                    </form>
                {% endif %}

                <!-- üí∞ Bid Form (active auctions only) -->
                {% if auction.is_active %}
                    <form action="{% url 'details' auction.id %}" method="post">
                        {% csrf_token %}
                        <label for="bid">Place a Bid:</label>
                        <input type="number" id="bid" name="bid" step="0.01" min="{{ min_bid }}" required>
                        <button type="submit">Submit Bid</button>
                    </form>
                {% endif %}

            {% else %}
                <p><a href="{% url 'login' %}">Login</a> to manage your watchlist and place bids.</p>
            {% endif %}

            <!-- Comments Section -->
            <h4>Comments</h4>
            <form action="{% url 'add_comment' auction.id %}" method="post">
                {% csrf_token %}
                <textarea name="content" rows="3" cols="50" placeholder="Add a comment..." ></textarea>
                <button type="submit">Post Comment</button>
            </form>

            <ul class="comments-list">
                {% for comment in auction.comments.all %}
                    <li>
                        <strong>{{ comment.user.username }}</strong> ({{ comment.created_at|date:"Y-m-d H:i" }}):
                        {{ comment.content }}
                    </li>
                {% empty %}
                    <li>No comments yet.</li>
                {% endfor %}
           
            <br>
            <a href="{% url 'index' %}">Back to Listings</a>
        </div>
    {% else %}
        <p>No details available for this auction.</p>
    {% endif %}
{% endblock %}


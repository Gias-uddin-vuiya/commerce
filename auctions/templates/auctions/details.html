{% extends "auctions/layout.html" %}

{% block body %}
    <h2>Auctions Details</h2>
    {% if auction %}
        <div class="auction-item">
            <h3>{{ auction.title }}</h3>
            <img src="{{ auction.image_url }}" width="300px" alt="Image not found">
            <p>{{ auction.description }}</p>
            <p>Starting Bid: ${{ auction.starting_bid }}</p>
            <p>Created by: {{ auction.creator.username }}</p>
            <p>Created on: {{ auction.created_at }}</p>

            <!-- Here we are showing user inputed bids We will work here later on -->
           {% if messages %}
                {% for message in messages %}
                    <p class="message {{ message.tags }}">{{ message }}</p>
                {% endfor %}
            {% endif %}
            <!-- add higher bids -->
            {% if highest_bid %}
                <p>Current highest bid: ${{ highest_bid }}</p>
            {% else %}
                <p>No bids yet</p>
            {% endif %}

                        
            {% if user.is_authenticated %}
                <!--  Close Auction Button (only for creator) -->
                {% if user == auction.creator and auction.is_active %}
                    <form action="{% url 'close_auction' auction.id %}" method="post">
                        {% csrf_token %}
                        <!-- if close is not true then show the close button Otherwise show acative button -->
                        <button type="submit">Close Auction</button>
                    </form>
                {% endif %}

                <!-- Watchlist Toggle (only if not creator) -->
                {% if user != auction.creator %}
                    <form action="{% url 'toggle_watchlist' auction.id %}" method="post">
                        {% csrf_token %}
                        {% if in_watchlist %}
                            <button type="submit">Remove from Watchlist</button>
                        {% else %}
                            <button type="submit">Add to Watchlist</button>
                        {% endif %}
                    </form>
                {% endif %}

                <!-- ðŸ’° Bid Form (active auctions only) -->
                {% if auction.is_active %}
                    <form action="{% url 'details' auction.id %}" method="post">
                        {% csrf_token %}
                        <label for="bid">Place a Bid:</label>
                        <input type="number" id="bid" name="bid" step="0.01" min="{{ min_bid }}" required>
                        <button type="submit">Submit Bid</button>
                    </form>
                {% else %}
                    <p>This auction is closed.</p>
                {% endif %}

            {% else %}
                <p><a href="{% url 'login' %}">Login</a> to manage your watchlist and place bids.</p>
            {% endif %}

            <br>
            <a href="{% url 'index' %}">Back to Listings</a>
        </div>
    {% else %}
        <p>No details available for this auction.</p>
    {% endif %}
{% endblock %}

